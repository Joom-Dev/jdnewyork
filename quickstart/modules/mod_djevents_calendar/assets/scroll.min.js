(function(o){var a=function(a){var e=this;e.scroll=jQuery(a),e.loader=e.scroll.find(".djev_loader").first(),e.responseContainer=o('<div style="display: none; visibility: hidden;" />'),e.responseContainer.appendTo(e.scroll),e.days=e.scroll.find(".active-day"),e.allDays=e.scroll.find(".djev_calendar_day"),e.dayLimit=e.allDays.length,e.tip_position=e.scroll.attr("data-tooltip-position")||"top",e.tip_open=e.scroll.attr("data-tooltip-open")||"mouseenter",e.tip_close=e.scroll.attr("data-tooltip-close")||"click",e.attachDaysEvents(e.days),e.scrolling=e.scroll.find(".djev_calendar_scroll_in").first(),e.scroll.find(".next-days").on("click",function(o){o.preventDefault();for(var a=.8*e.scrolling.innerWidth(),n=a,t=e.scrolling.prop("scrollWidth"),l=e.scrolling.width(),r=0;r<e.allDays.length;r++){var s=jQuery(e.allDays[r]),i=s.position().left;if(i>a)break;n=i}var d=e.scrolling.scrollLeft()+n;e.scrolling.animate({scrollLeft:d},function(){d+l>t&&e.load(1)})}),e.scroll.find(".prev-days").on("click",function(o){o.preventDefault();for(var a=.8*-e.scrolling.innerWidth(),n=a,t=(e.scrolling.prop("scrollWidth"),e.scrolling.width(),0);t<e.allDays.length;t++){var l=jQuery(e.allDays[t]),r=l.position().left;if(r>a)break;n=r}var s=e.scrolling.scrollLeft()+n;e.scrolling.animate({scrollLeft:s},function(){})})};a.prototype.attachDaysEvents=function(a){var e=this;a.popover({animation:!1,html:!0,placement:e.tip_position,trigger:"manual",container:"body"}),"click"==e.tip_open?a.on("click",function(e){e.stopPropagation();var n=o(this);n.hasClass("open-day")||e.preventDefault(),a.popover("hide").removeClass("open-day"),n.popover("show").addClass("open-day")}):(a.on("mouseenter",function(e){e.stopPropagation();var n=o(this);n.hasClass("open-day")||(a.popover("hide").removeClass("open-day"),n.popover("show").addClass("open-day"))}),a.on("click focus",function(a){a.stopPropagation(),o(this).trigger("mouseenter")})),"click"==e.tip_close?o(document.body).on("click",function(e){o(e.target).parents(".popover").length||a.popover("hide").removeClass("open-day")}):(e.scroll.on("mouseleave",function(e){e.stopPropagation(),a.hasClass("open-day")&&!o(".popover:hover").length&&a.popover("hide").removeClass("open-day")}),o(document).on("mouseleave",".popover-content",function(){a.hasClass("open-day")&&a.popover("hide").removeClass("open-day")}))},a.prototype.xhr=null,a.prototype.sendXhr=function(a,e){var n=this;if(!n.xhr||4==n.xhr.readyState){n.loader.css("display","block");var t=n.scroll.attr("data-baseurl"),l=n.scroll.attr("data-module");n.xhr=o.ajax({url:t,method:"post",data:"option=com_djevents&task=getDays&format=raw&last_date="+e+"&direction="+a+"&days="+n.dayLimit+"&module="+l}).done(function(o){""!=o&&(n.appendDays(a,o),a>0?n.scroll.find(".next-days").trigger("click"):n.scroll.find(".prev-days").trigger("click"))}).always(function(){n.loader.css("display","none")})}},a.prototype.load=function(a){var e=this,n=a>0?o(e.allDays[e.allDays.length-1]).attr("data-date"):o(e.allDays[0]).attr("data-date");e.sendXhr(a,n)},a.prototype.appendDays=function(o,a){var e=this;e.responseContainer.html(a);var n=e.responseContainer.find(".active-day");e.attachDaysEvents(n),o>0?e.scrolling.append(e.responseContainer.find(".djev_calendar_day")):e.scrolling.prepend(e.responseContainer.find(".djev_calendar_day")),e.responseContainer.empty(),e.allDays=e.scroll.find(".djev_calendar_day"),e.days=e.scroll.find(".active-day")},o(document).ready(function(){o(".djev_calendar_days").each(function(){new a(this)})})})(jQuery);